{% load quiz_template_tags %}
{% load smartif %}

<div>
  Welcome to the Care stats page.
</div>

<div id = "task">
  {{task}}
</div>


<table border ="1px">

  <tr>
    <td colspan = "11">
    </td>
        {% for question_id_string, question in questions_in_order %}
        <th >{{ question_id_string}}
        </th>
        {%endfor%}
  </tr>
  <tr>
    <td colspan = "11">
    </td>
        {% for question_id_string, question in questions_in_order %}
        <th > {{question.quiz.label}}
        </th>
        {%endfor%}
  </tr>

  <tr>
  
  <th>
    uni
  </th>  
  <th>
    first_name
  </th>  
  <th>
    last_name
  </th>  
  <th>
    semester
  </th>  
  
  <th>
    year
  </th>  
  
  <th>
    section
  </th>  
  
  <th>
    completed_training
  </th>  
  <th>
    taking_action
  </th>  
  <th>
    abuse_or_accient
  </th>  
  
  <th>
    pre-test
  </th>
  
  <th>
    post-test_initial
  </th>
  {% for question_id_string, question in questions_in_order %}
  <th >{{question.short_text}}...</th>
  {%endfor%}
  </tr>  
{%for row in stats.values %}
  <tr>
  
  <td>
  {{row.user_object.username}}
   </td>
  <td>
  {{row.user_object.first_name}}
   </td>
  <td>
  {{row.user_object.last_name}}
   </td>
  <td>
  {%for c in row.user_object.classes_i_take%}
    {%ifequal c.4 '6010'%}
      {{c.0}}
    {%endifequal%}
  {%endfor %}
   </td>
  <td>
  {%for c in row.user_object.classes_i_take%}
    {%ifequal c.4 '6010'%}
      {{c.1}} 
    {%endifequal%}
  {%endfor %}
   </td>
  <td>
  {%for c in row.user_object.classes_i_take%}
    {%ifequal c.4 '6010'%}
      {{c.2}}
    {%endifequal%}
  {%endfor %}
   </td>

  <td>
     {% get_scores for 'post-test' in row.quizzes as score %}
        {%if score.all_correct and score.all_correct == "t" %}
            complete
        {% else %}
            incomplete
        {%endif %}
  </td>

  <td>
  	 {%if row.taking_action %}complete{%else%}incomplete{%endif%}
   </td>

  <td>
  	 {%if row.bruise_recon %}{{row.bruise_recon}}{%else%}n/a{%endif%}
  </td>

  <td >
    {% get_scores for 'pre-test' in row.quizzes as score %}
    {% if score.answer_count %}
       {{score.score}} / {{score.answer_count}}
    {% else %}
        n/a
    {%endif %}
  </td/>
  
  <td>
      {% get_scores for 'post-test' in row.quizzes as score %}
      {% if score.initial_score.quiz_score %}
      {{score.initial_score.quiz_score}} /  {{score.initial_score.quiz_max_score}}
      {% else %}
          n/a
      {%endif %}
  </td>

  {% with row.answers as  a  %}
    {% for question_id_string, question in questions_in_order %}
      <td>
        {%for row_question_id, correct_incorrect in row.answers.iteritems %}
            {% ifequal question_id_string row_question_id %}
                {{correct_incorrect}}
            {%endifequal %}
        {%endfor %}
      </td>
    {%endfor%}
  {% endwith %}

   </tr>
{%endfor %}
</table>
</div>
